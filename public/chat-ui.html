<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Torem AI Chat</title>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: 'Segoe UI', sans-serif; background: transparent; }
    .chat-wrapper { display:flex; flex-direction:column; height:100%; width:100%; border-radius:16px; overflow:hidden; box-shadow:0 6px 20px rgba(0,0,0,0.15); background:#fff; }
    .chat-header { display:flex; align-items:center; gap:10px; padding:16px; font-weight:600; font-size:16px; background:#fff; border-bottom:1px solid #eee; flex-shrink:0; }
    .chat-logo { width:70px; height:70px; border-radius:50%; object-fit:cover; }
    .chat-body { flex:1; overflow-y:auto; padding:16px; background:#fff; }
    .bot-message { margin-bottom:12px; font-size:14px; }
    .quick-replies { display:flex; flex-direction:column; gap:8px; margin-bottom:16px; }
    .quick-replies button { padding:10px 14px; background:#f0f2ff; border:none; border-radius:10px; color:#2b4eff; font-size:14px; text-align:left; cursor:pointer; }
    .quick-replies button:hover { background:#e0e7ff; }
    .chat-footer { display:flex; align-items:center; gap:8px; padding:16px; background:#fff; border-top:1px solid #eee; flex-shrink:0; }
    .chat-footer input { flex:1; padding:12px; border-radius:12px; border:1px solid #ccc; font-size:14px; }
    .chat-footer button { padding:12px 16px; background:#2b4eff; border:none; color:white; font-size:14px; border-radius:12px; cursor:pointer; }
    .response { font-size:14px; margin-top:12px; white-space:pre-wrap; }
    .loading { font-size:13px; color:#aaa; margin-top:8px; }
  </style>
</head>
<body>
  <div class="chat-wrapper">
    <div class="chat-header">
      <img class="chat-logo" src="https://torem-float-widget.vercel.app/Image.png" alt="Logo" />
      Torem AI
    </div>

    <div class="chat-body" id="chatBody">
      <div class="bot-message">
        Hi ðŸ‘‹ Ready to explore Torem AI?<br />
        Ask me anything to get started with automating your business!
      </div>

      <div class="quick-replies">
        <button onclick="fillAndSend('How does your chatbot work?')">How does your chatbot work?</button>
        <button onclick="fillAndSend('Do you integrate with CRMs?')">Do you integrate with CRMs?</button>
        <button onclick="fillAndSend('What industries do you support?')">What industries do you support?</button>
      </div>

      <div id="messages"></div>
      <div id="loading" class="loading" style="display:none;">Loading...</div>
    </div>

    <div class="chat-footer">
      <input type="text" id="msg" placeholder="Write your message" />
      <button onclick="send()">Send</button>
    </div>
  </div>

  <script>
    function fillAndSend(msg) {
      document.getElementById('msg').value = msg;
      send();
    }

    async function send() {
      const inputEl = document.getElementById("msg");
      const input = inputEl.value.trim();
      if (!input) return;

      const messagesDiv = document.getElementById("messages");
      const loading = document.getElementById("loading");
      loading.style.display = 'block';

      // Show the user's message in the UI
      const userDiv = document.createElement("div");
      userDiv.className = "response";
      userDiv.innerText = "You: " + input;
      messagesDiv.appendChild(userDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      try {
        const resp = await fetch("https://toremai.app.n8n.cloud/webhook/chatbot", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: input,
            session_id: "site-visitor",
            client_id: "torem",
          }),
        });

        // Log raw response for debugging (inspect network console too)
        const text = await resp.text();
        console.log("Webhook response status:", resp.status, "body raw:", text);

        // try to parse JSON safely
        let data;
        try { data = JSON.parse(text); } catch (e) { data = { reply: text }; }

        const replyDiv = document.createElement("div");
        replyDiv.className = "response";
        replyDiv.innerText = data && (data.reply || data.message || data.output) ? (data.reply || data.message || data.output) : "(No reply)";
        messagesDiv.appendChild(replyDiv);

        if (!resp.ok) {
          // If server returned 500/400, show details
          const errDiv = document.createElement("div");
          errDiv.className = "response";
          errDiv.innerText = `Server returned ${resp.status}. See console/network for details.`;
          messagesDiv.appendChild(errDiv);
        }

      } catch (err) {
        console.error("Fetch error:", err);
        const errorDiv = document.createElement("div");
        errorDiv.className = "response";
        errorDiv.innerText = "Error: " + err.message;
        messagesDiv.appendChild(errorDiv);
      } finally {
        loading.style.display = 'none';
        inputEl.value = "";
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
    }
  </script>
</body>
</html>
